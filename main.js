(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){"Escape"===e.key&&o(document.querySelector(".popup_opened"))}function n(e){e.classList.add("popup_opened"),document.addEventListener("keydown",t)}function o(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",t)}e.d({},{MG:()=>B,qJ:()=>M});var r=document.querySelector(".profile__image"),c=document.querySelector(".profile__avatar-button"),u=document.querySelector(".profile__edit-button"),a=document.querySelector(".profile__add-button"),i=document.querySelector(".profile__title"),l=document.querySelector(".profile__subtitle"),s=document.querySelector(".popup_type_profile"),p=s.querySelector(".popup__form"),d=p.querySelector(".popup__input_name_name-and-surname"),_=p.querySelector(".popup__input_name_work"),f=document.querySelector(".elements"),m=f.querySelector("#element").content,v=document.querySelector(".popup_type_card"),h=v.querySelector(".popup__form"),y=h.querySelector(".popup__input_name_image-title"),S=h.querySelector(".popup__input_name_image-url"),b=document.querySelector(".popup_type_image"),q=b.querySelector(".popup__image"),g=b.querySelector(".popup__caption"),E=document.querySelector(".popup_type_avatar"),L=E.querySelector(".popup__form"),k=L.querySelector(".popup__input_name_avatar-url"),C=document.querySelectorAll(".popup");function x(e,t){var n=t.querySelector(".popup__submit");e?n.classList.add("popup__submit_loading"):n.classList.remove("popup__submit_loading")}function U(e,t,o,r,c,u){var a=m.cloneNode(!0),i=a.querySelector(".element__image"),l=a.querySelector(".element__title"),s=a.querySelector(".element__like-button"),p=a.querySelector(".element__like-number"),d=a.querySelector(".element__delete-button");return l.textContent=e,i.src=t,i.alt=e,p.textContent=o,!0===u&&s.classList.add("element__like-button_active"),s.addEventListener("click",(function(e){M(e,c,p)})),r?d.addEventListener("click",(function(e){B(e,c)})):d.disabled=!0,i.addEventListener("click",(function(){q.src=i.src,q.alt=l.textContent,g.textContent=l.textContent,n(b)})),a}function A(e,t,n){e.target.classList.contains("element__like-button_active")?e.target.classList.remove("element__like-button_active"):e.target.classList.add("element__like-button_active"),n.textContent=t}function T(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.disabled=!1:t.disabled=!0}var O={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"df96d3b0-3822-438d-a20e-f1a1a788e6cc","Content-Type":"application/json"}};function P(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var w,D,j="",J="";function N(e){f.prepend(e)}function G(e){e.querySelector(".popup__form").reset();var t=e.querySelectorAll(".popup__input"),n=e.querySelectorAll(".popup__input-error");t.forEach((function(e){e.classList.remove("popup__input_type_error")})),n.forEach((function(e){e.classList.remove("popup__input-error_active"),e.textContent=""})),e.querySelector(".popup__submit").disabled=!0}function M(e,t,n){e.target.classList.contains("element__like-button_active")?function(e){return fetch("".concat(O.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:O.headers}).then((function(e){return P(e)}))}(t).then((function(t){var o=t.likes.length;A(e,o,n)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(O.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:O.headers}).then((function(e){return P(e)}))}(t).then((function(t){var o=t.likes.length;A(e,o,n)})).catch((function(e){console.log(e)}))}function B(e,t){(function(e){return fetch("".concat(O.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:O.headers}).then((function(e){return P(e)}))})(t).then((function(){!function(e){e.target.parentElement.remove()}(e)})).catch((function(e){console.log(e)}))}fetch("".concat(O.baseUrl,"/users/me"),{method:"GET",headers:O.headers}).then((function(e){return P(e)})).then((function(e){console.log(e),i.textContent=e.name,l.textContent=e.about,r.src=e.avatar,j=e._id})).catch((function(e){console.log(e)})),fetch("".concat(O.baseUrl,"/cards"),{method:"GET",headers:O.headers}).then((function(e){return P(e)})).then((function(e){e.reverse().forEach((function(e){var t=e.owner._id===j;w=e.likes.some((function(e){return e._id==j})),J=e._id,N(U(e.name,e.link,e.likes.length,t,J,w))}))})).catch((function(e){console.log(e)})),C.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&o(e),t.target.classList.contains("popup__close-button")&&o(e)}))})),c.addEventListener("click",(function(){G(E),n(E)})),u.addEventListener("click",(function(){G(s),d.value=i.textContent,_.value=l.textContent,n(s)})),a.addEventListener("click",(function(){G(v),n(v)})),p.addEventListener("submit",(function(e){var t,n;e.preventDefault(),x(!0,s),(t=d.value,n=_.value,fetch("".concat(O.baseUrl,"/users/me"),{method:"PATCH",headers:O.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){P(e)}))).then((function(){i.textContent=d.value,l.textContent=_.value,o(s)})).catch((function(e){console.log(e)})).finally((function(){x(!1,s)}))})),h.addEventListener("submit",(function(e){e.preventDefault(),x(!0,v),function(e,t){return fetch("".concat(O.baseUrl,"/cards"),{method:"POST",headers:O.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return P(e)}))}(y.value,S.value).then((function(e){N(U(e.name,e.link,e.likes.length,!0,e._id,!1)),o(v)})).catch((function(e){console.log(e)})).finally((function(){x(!1,v)}))})),L.addEventListener("submit",(function(e){e.preventDefault(),x(!0,E);var t,n=k.value;(t=n,fetch("".concat(O.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:O.headers,body:JSON.stringify({avatar:t})}).then((function(e){return P(e)}))).then((function(){r.src=n,o(E)})).catch((function(e){console.log(e)})).finally((function(){x(!1,E)}))})),D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(D.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);T(n,o),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity("Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),T(n,o)}))}))}(e,D)}))})();